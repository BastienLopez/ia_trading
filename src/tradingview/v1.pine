//@version=6
indicator("BTC Trading Signals", overlay=true)

// Paramètres
rsi_length = input.int(14, "RSI Length", minval=1)
rsi_overbought = input.float(70, "RSI Overbought", minval=0, maxval=100)
rsi_oversold = input.float(30, "RSI Oversold", minval=0, maxval=100)

macd_fast = input.int(12, "MACD Fast Length", minval=1)
macd_slow = input.int(26, "MACD Slow Length", minval=1)
macd_signal = input.int(9, "MACD Signal Length", minval=1)

ema_short = input.int(9, "EMA Short Length", minval=1)
ema_long = input.int(21, "EMA Long Length", minval=1)

// Calcul des indicateurs
rsi = ta.rsi(close, rsi_length)
[macd_line, signal_line, hist_line] = ta.macd(close, macd_fast, macd_slow, macd_signal)
ema9 = ta.ema(close, ema_short)
ema21 = ta.ema(close, ema_long)

// Conditions de signal
rsi_oversold_condition = rsi < rsi_oversold
rsi_overbought_condition = rsi > rsi_overbought

macd_bullish = ta.crossover(macd_line, signal_line)
macd_bearish = ta.crossunder(macd_line, signal_line)

ema_bullish = ta.crossover(ema9, ema21)
ema_bearish = ta.crossunder(ema9, ema21)

// Logs pour débogage
var table debug_table = table.new(position.top_right, 6, 4, bgcolor=color.black)
table.cell(debug_table, 0, 0, "Indicateur", bgcolor=color.gray, text_color=color.white)
table.cell(debug_table, 1, 0, "Valeur", bgcolor=color.gray, text_color=color.white)
table.cell(debug_table, 0, 1, "RSI", text_color=color.white)
table.cell(debug_table, 1, 1, str.tostring(rsi, "#.##"), text_color=color.white)
table.cell(debug_table, 0, 2, "MACD", text_color=color.white)
table.cell(debug_table, 1, 2, str.tostring(macd_line, "#.##"), text_color=color.white)
table.cell(debug_table, 0, 3, "Signal", text_color=color.white)
table.cell(debug_table, 1, 3, str.tostring(signal_line, "#.##"), text_color=color.white)

// Affichage des signaux
plotshape(series=rsi_oversold_condition, title="RSI Oversold", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)
plotshape(series=rsi_overbought_condition, title="RSI Overbought", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.small)

plotshape(series=macd_bullish, title="MACD Bullish", location=location.belowbar, color=color.green, style=shape.diamond, size=size.small)
plotshape(series=macd_bearish, title="MACD Bearish", location=location.abovebar, color=color.red, style=shape.diamond, size=size.small)

plotshape(series=ema_bullish, title="EMA Bullish", location=location.belowbar, color=color.green, style=shape.circle, size=size.small)
plotshape(series=ema_bearish, title="EMA Bearish", location=location.abovebar, color=color.red, style=shape.circle, size=size.small)

// Affichage des indicateurs
plot(ema9, "EMA9", color=color.blue)
plot(ema21, "EMA21", color=color.orange)

// Alerte
alertcondition(rsi_oversold_condition or rsi_overbought_condition or macd_bullish or macd_bearish or ema_bullish or ema_bearish, title="Signal Alert", message="Signal détecté: {{ticker}} - {{interval}}") 