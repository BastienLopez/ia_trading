{% extends "base.html" %}

{% block title %}Accueil - Crypto Trading IA{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 text-center mb-4">
        <h1 class="display-4">Bienvenue sur Crypto Trading IA</h1>
        <p class="lead">Une plateforme d'intelligence artificielle pour le trading de cryptomonnaies</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <i class="fas fa-chart-line fa-3x mb-3 text-primary"></i>
                <h5 class="card-title">Tableau de bord</h5>
                <p class="card-text">Visualisez en temps réel les performances de vos stratégies de trading et l'état de votre portefeuille.</p>
                <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Accéder</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <i class="fas fa-flask fa-3x mb-3 text-success"></i>
                <h5 class="card-title">Backtests</h5>
                <p class="card-text">Analysez les performances de l'agent IA sur des données historiques pour valider sa stratégie.</p>
                <a href="{{ url_for('backtest') }}" class="btn btn-success">Découvrir</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
                <i class="fas fa-robot fa-3x mb-3 text-info"></i>
                <h5 class="card-title">Technologie IA</h5>
                <p class="card-text">Notre système utilise l'apprentissage par renforcement pour optimiser ses décisions de trading.</p>
                <a href="#technology" class="btn btn-info">En savoir plus</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">DERNIÈRES PERFORMANCES</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12 mb-4">
                        <div class="text-center text-muted mb-3">Performance mensuelle</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-7">
                        <canvas id="performanceChart" width="400" height="300"></canvas>
                        <div class="mt-3 text-muted small">
                            <p><strong>Comprendre le graphique de performance mensuelle :</strong></p>
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="fas fa-circle text-primary me-2"></i><strong>Ligne bleue (Stratégie IA)</strong> : Montre les performances de notre algorithme IA qui trade activement sur les 5 derniers mois.</li>
                                <li class="mb-2"><i class="fas fa-circle text-danger me-2"></i><strong>Zone rouge (Buy & Hold)</strong> : Représente l'évolution du prix de l'actif sans intervention sur la même période.</li>
                            </ul>
                            <p>Le graphique présente ces deux approches ensemble pour comparaison :</p>
                            <ul class="list-unstyled mb-3">
                                <li><i class="fas fa-check text-success me-2"></i>La ligne bleue au-dessus de la zone rouge indique que l'IA surperforme le simple achat-conservation.</li>
                                <li><i class="fas fa-info-circle text-info me-2"></i>Pendant les baisses du marché (valeurs négatives), notre IA vise à minimiser les pertes par rapport au Buy & Hold.</li>
                            </ul>
                            <p>Passez votre souris sur les points du graphique pour voir les valeurs exactes de chaque mois.</p>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="table-responsive">
                            <table class="table performance-table">
                                <thead>
                                    <tr class="text-center text-success">
                                        <th>ACTIF</th>
                                        <th>PROFIT</th>
                                        <th>BUY & HOLD</th>
                                        <th>SURPERFORMANCE</th>
                                    </tr>
                                </thead>
                                <tbody id="performance-table" class="text-center">
                                    <tr>
                                        <td colspan="4" class="text-center">Chargement des données...</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="mt-3 text-muted small">
                                <p><strong>Légende du tableau de performance :</strong></p>
                                <ul class="list-unstyled">
                                    <li class="mb-2"><strong>Profit</strong> : Performance globale de notre stratégie d'IA sur la période analysée. Ce pourcentage représente le gain total réalisé par notre algorithme de trading.</li>
                                    <li class="mb-2"><strong>Buy & Hold</strong> : Performance d'une stratégie simple d'achat et conservation sur la même période. Cette approche passive consiste à acheter et conserver l'actif sans intervention.</li>
                                    <li class="mb-2"><strong>Surperformance</strong> : Différence entre notre stratégie IA et Buy & Hold, démontrant l'avantage concret de notre approche algorithmique par rapport à une stratégie passive.</li>
                                </ul>
                                <p class="mt-3">Les valeurs positives en vert indiquent une performance supérieure de notre stratégie par rapport au marché, tandis que les valeurs négatives en rouge signaleraient une sous-performance.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-5" id="technology">
    <div class="col-md-12">
        <h2 class="border-bottom pb-2">Notre technologie</h2>
    </div>
    <div class="col-md-6">
        <h4>Apprentissage par renforcement</h4>
        <p>
            Notre agent de trading s'appuie sur l'apprentissage par renforcement (RL), une branche de l'intelligence artificielle où un agent apprend à prendre des décisions optimales en interagissant avec son environnement.
        </p>
        <p>
            Nous utilisons l'algorithme PPO (Proximal Policy Optimization) pour entraîner notre agent à maximiser ses gains sur les marchés cryptographiques volatils.
        </p>
    </div>
    <div class="col-md-6">
        <h4>Indicateurs techniques avancés</h4>
        <p>
            L'agent analyse une multitude d'indicateurs techniques pour prendre ses décisions :
        </p>
        <ul>
            <li>RSI (Relative Strength Index)</li>
            <li>MACD (Moving Average Convergence Divergence)</li>
            <li>Bandes de Bollinger</li>
            <li>Moyennes mobiles exponentielles</li>
            <li>Ichimoku Cloud</li>
            <li>Et bien d'autres...</li>
        </ul>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Charger les données de performance
    fetch('/api/performance')
        .then(response => response.json())
        .then(data => {
            // Mettre à jour le tableau
            const tableBody = document.getElementById('performance-table');
            tableBody.innerHTML = '';
            
            data.assets.forEach(asset => {
                const row = document.createElement('tr');
                const surperformance = (asset.profit_pct - asset.buy_hold_pct).toFixed(2);
                const surperformanceClass = surperformance > 0 ? 'text-success' : 'text-danger';
                
                row.innerHTML = `
                    <td>${asset.symbol}</td>
                    <td class="text-center">${asset.profit_pct.toFixed(2)}%</td>
                    <td class="text-center">${asset.buy_hold_pct.toFixed(2)}%</td>
                    <td class="text-center ${surperformanceClass}">${surperformance > 0 ? '+' : ''}${surperformance}%</td>
                `;
                tableBody.appendChild(row);
            });
            
            // Créer le graphique
            const performanceData = {
                labels: data.monthly.map(item => item.month),
                datasets: [
                    {
                        label: 'Stratégie IA',
                        data: data.monthly.map(item => item.profit_pct),
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'transparent',
                        borderWidth: 3,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                        pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                        tension: 0.3,
                        fill: false,
                        zIndex: 2,
                        order: 1
                    },
                    {
                        label: 'Buy & Hold',
                        data: data.monthly.map(item => item.buy_hold_pct),
                        borderColor: 'rgba(255, 99, 132, 0.8)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 7,
                        tension: 0.3,
                        fill: 'origin',
                        zIndex: 1,
                        order: 2
                    }
                ]
            };
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: performanceData,
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: false,
                            text: 'Performance mensuelle',
                            font: {
                                size: 16
                            },
                            padding: {
                                bottom: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: {
                                    size: 11
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Erreur lors du chargement des données:', error);
            document.getElementById('performance-table').innerHTML = `
                <tr>
                    <td colspan="4" class="text-center text-danger">Erreur lors du chargement des données</td>
                </tr>
            `;
        });
});
</script>
{% endblock %} 