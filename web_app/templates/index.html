{% extends "base.html" %}

{% block title %}Accueil - Crypto Trading IA{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 text-center mb-4">
        <h1 class="display-4">Bienvenue sur Crypto Trading IA</h1>
        <p class="lead">Une plateforme d'intelligence artificielle pour le trading de cryptomonnaies</p>
    </div>
</div>

<!-- Section des fonctionnalités -->
<section class="features py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="card h-100 d-flex flex-column">
                    <div class="card-body d-flex flex-column text-center">
                        <div class="text-center mb-4">
                            <i class="fas fa-chart-line fa-3x text-primary"></i>
                            <h3 class="card-title mt-3 h4">Tableau de bord</h3>
                        </div>
                        <p class="card-text flex-grow-1 d-flex align-items-center justify-content-center">Visualisez en temps réel les performances de vos stratégies de trading et l'état de votre portefeuille.</p>
                        <div class="text-center mt-auto">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-primary px-4">Accéder</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 d-flex flex-column">
                    <div class="card-body d-flex flex-column text-center">
                        <div class="text-center mb-4">
                            <i class="fas fa-flask fa-3x text-success"></i>
                            <h3 class="card-title mt-3 h4">Backtests</h3>
                        </div>
                        <p class="card-text flex-grow-1 d-flex align-items-center justify-content-center">Analysez les performances de l'agent IA sur des données historiques pour valider sa stratégie.</p>
                        <div class="text-center mt-auto">
                            <a href="{{ url_for('backtest') }}" class="btn btn-success px-4">Découvrir</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 d-flex flex-column">
                    <div class="card-body d-flex flex-column text-center">
                        <div class="text-center mb-4">
                            <i class="fas fa-robot fa-3x text-primary"></i>
                            <h3 class="card-title mt-3 h4">Technologie IA</h3>
                        </div>
                        <p class="card-text flex-grow-1 d-flex align-items-center justify-content-center">Notre plateforme utilise des modèles d'intelligence artificielle avancés pour analyser le marché et prendre des décisions de trading optimales.</p>
                        <div class="text-center mt-auto">
                            <a href="{{ url_for('technology') }}" class="btn btn-primary px-4">En savoir plus</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="row mt-5">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">DERNIÈRES PERFORMANCES</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12 mb-4">
                        <div class="text-center text-muted mb-3">Performance mensuelle</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-7">
                        <canvas id="performanceChart" width="400" height="300"></canvas>
                        <div class="mt-3 text-muted small">
                            <p><strong>Comprendre le graphique de performance mensuelle :</strong></p>
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="fas fa-circle text-primary me-2"></i><strong>Ligne bleue (Stratégie IA)</strong> : Montre les performances de notre algorithme IA qui trade activement sur les 5 derniers mois.</li>
                                <li class="mb-2"><i class="fas fa-circle text-danger me-2"></i><strong>Zone rouge (Buy & Hold)</strong> : Représente l'évolution du prix de l'actif sans intervention sur la même période.</li>
                            </ul>
                            <p>Le graphique présente ces deux approches ensemble pour comparaison :</p>
                            <ul class="list-unstyled mb-3">
                                <li><i class="fas fa-check text-success me-2"></i>La ligne bleue au-dessus de la zone rouge indique que l'IA surperforme le simple achat-conservation.</li>
                                <li><i class="fas fa-info-circle text-info me-2"></i>Pendant les baisses du marché (valeurs négatives), notre IA vise à minimiser les pertes par rapport au Buy & Hold.</li>
                            </ul>
                            <p>Passez votre souris sur les points du graphique pour voir les valeurs exactes de chaque mois.</p>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="table-responsive">
                            <table class="table performance-table">
                                <thead>
                                    <tr class="text-center text-success">
                                        <th>ACTIF</th>
                                        <th>PROFIT</th>
                                        <th>BUY & HOLD</th>
                                        <th>SURPERFORMANCE</th>
                                    </tr>
                                </thead>
                                <tbody id="performance-table" class="text-center">
                                    <tr>
                                        <td colspan="4" class="text-center">Chargement des données...</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="mt-3 text-muted small">
                                <p><strong>Légende du tableau de performance :</strong></p>
                                <ul class="list-unstyled">
                                    <li class="mb-2"><strong>Profit</strong> : Performance globale de notre stratégie d'IA sur la période analysée. Ce pourcentage représente le gain total réalisé par notre algorithme de trading.</li>
                                    <li class="mb-2"><strong>Buy & Hold</strong> : Performance d'une stratégie simple d'achat et conservation sur la même période. Cette approche passive consiste à acheter et conserver l'actif sans intervention.</li>
                                    <li class="mb-2"><strong>Surperformance</strong> : Différence entre notre stratégie IA et Buy & Hold, démontrant l'avantage concret de notre approche algorithmique par rapport à une stratégie passive.</li>
                                </ul>
                                <p class="mt-3">Les valeurs positives en vert indiquent une performance supérieure de notre stratégie par rapport au marché, tandis que les valeurs négatives en rouge signaleraient une sous-performance.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Charger les données de performance
    fetch('/api/performance')
        .then(response => response.json())
        .then(data => {
            // Mettre à jour le tableau
            const tableBody = document.getElementById('performance-table');
            tableBody.innerHTML = '';
            
            data.assets.forEach(asset => {
                const row = document.createElement('tr');
                const surperformance = (asset.profit_pct - asset.buy_hold_pct).toFixed(2);
                const surperformanceClass = surperformance > 0 ? 'text-success' : 'text-danger';
                
                row.innerHTML = `
                    <td>${asset.symbol}</td>
                    <td class="text-center">${asset.profit_pct.toFixed(2)}%</td>
                    <td class="text-center">${asset.buy_hold_pct.toFixed(2)}%</td>
                    <td class="text-center ${surperformanceClass}">${surperformance > 0 ? '+' : ''}${surperformance}%</td>
                `;
                tableBody.appendChild(row);
            });
            
            // Créer le graphique
            const performanceData = {
                labels: data.monthly.map(item => item.month),
                datasets: [
                    {
                        label: 'Stratégie IA',
                        data: data.monthly.map(item => item.profit_pct),
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'transparent',
                        borderWidth: 3,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                        pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                        tension: 0.3,
                        fill: false,
                        zIndex: 2,
                        order: 1
                    },
                    {
                        label: 'Buy & Hold',
                        data: data.monthly.map(item => item.buy_hold_pct),
                        borderColor: 'rgba(255, 99, 132, 0.8)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 7,
                        tension: 0.3,
                        fill: 'origin',
                        zIndex: 1,
                        order: 2
                    }
                ]
            };
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: performanceData,
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: false,
                            text: 'Performance mensuelle',
                            font: {
                                size: 16
                            },
                            padding: {
                                bottom: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: {
                                    size: 11
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Erreur lors du chargement des données:', error);
            document.getElementById('performance-table').innerHTML = `
                <tr>
                    <td colspan="4" class="text-center text-danger">Erreur lors du chargement des données</td>
                </tr>
            `;
        });
});
</script>
{% endblock %}

<style>
.card {
    border: 1px solid rgba(255, 255, 255, 0.1);
    background-color: #2F3136;
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-5px);
}

.card-title {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: #fff;
}

.card-text {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1rem;
    line-height: 1.5;
    margin: 0;
    padding: 0 1rem;
}

.btn {
    min-width: 140px;
    padding: 0.5rem 1.5rem;
}

.features .fa-3x {
    margin-bottom: 1rem;
}

/* Ajustement des couleurs des icônes */
.text-primary {
    color: #007bff !important;
}

.text-success {
    color: #28a745 !important;
}

/* Espacement uniforme */
.card-body {
    padding: 2rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
}
</style> 